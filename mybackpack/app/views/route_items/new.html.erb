<h1>Recommended list of items</h1>

<!--
<%= render 'form', route_item: @route_item %>
 -->



<% if @user_items.kind_of?(Array) %>

<div>
  <h4><%= current_user.profile.first_name %> <%= current_user.profile.last_name %></h4>
</div>

  <% sum = 0 %>
  <div>
  <% @categories.each do |category| %>
    <p><strong><%= category %></strong></p>
    <table>
      <thead>
        <tr>
          <th style="width: 250px">Item</th>
          <th>Count</th>
          <th>Weight (kg)</th>
          <th>Individualy</th>
          <th>Importance</th>
          <th colspan="3"></th>
        </tr>
      </thead>

      <tbody>
        <% UserAvailableItem.category_items(@user_items, category).each do |i| %>
          <tr>
            <% sum += i.item.weight %>
            <td><%= i.item.title %></td>
            <td><%= 1 %></td>
            <td><%= i.item.weight %></td>
            <td><%= i.item.individualy %></td>
            <td><%= i.item.object_importance.title %></td>
            <td><%= link_to 'Show', item_path(i.item) %></td>
            <td><%= link_to 'Edit', edit_user_available_item_path(i) %></td>
            <td><%= link_to 'Destroy', i, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <br>
  <% end %>
    <div>
      <p><strong>Sum: <%= sum.round(2) %> kg</strong></p>
    </div>
  </div>

<% else %>

  <% @user_items.each do |user, items| %>
  <% @categories1 = UserAvailableItem.item_categories(items)%>

  <div>
    <h4><%= User.find(user).profile.first_name %> <%= User.find(user).profile.last_name %></h4>
  </div>

<% sum = 0 %>
  <div>
  <% @categories1.each do |category| %>
    <p><strong><%= category %></strong></p>
    <table>
      <thead>
        <tr>
          <th style="width: 250px">Item</th>
          <th>Count</th>
          <th>Weight (kg)</th>
          <th>Individualy</th>
          <th>Importance</th>
          <th colspan="3"></th>
        </tr>
      </thead>

      <tbody>
        <% UserAvailableItem.category_items(items, category).each do |i| %>
          <tr>
            <% sum += i.item.weight %>
            <td><%= i.item.title %></td>
            <td><%= 1 %></td>
            <td><%= i.item.weight %></td>
            <td><%= i.item.individualy %></td>
            <td><%= i.item.object_importance.title %></td>
            <td><%= link_to 'Show', item_path(i.item) %></td>
            <td><%= link_to 'Edit', edit_user_available_item_path(i) %></td>
            <td><%= link_to 'Destroy', i, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <br>
  <% end %>
    <div>
      <p><strong>Sum: <%= sum.round(2) %> kg</strong></p>
    </div>
  </div>




  <% end %>

<% end %>





<div>
  <p>
    <%= link_to 'OK', route_path(@route) %>
    <%= link_to 'Back', route_items_path %>
  </p>
</div>
